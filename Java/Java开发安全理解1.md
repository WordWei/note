### Java开发中的安全问题<一>

 安全是软件开发领域永远的主题之一 

####  Java 应用开发中的注入攻击 

#####  SQL 注入攻击 

 一个典型的场景就是 Web 系统的用户登录功能，根据用户输入的用户名和密码，我们需要去后端数据库核实信息。 

```java
Select * from use_info where username = “input_usr_name” and password = “input_pwd”
```

> 输入 “ or “”=”

```java
Select * from use_info where username = “input_usr_name” and password = “” or “” = “”
```

 利用了期望输入和可能输入之间的偏差 , 不同 SQL 语句，进行各种不同目的的攻击, 这就是sql注入攻击。

##### 操作系统命令注入 

 Java 语言提供了类似 Runtime.exec(…) 的 API，可以用来执行特定命令，假设我们构建了一个应用，以输入文本作为参数，执行下面的命令： 

```shell
ls –la input_file_name
```

 如果用户输入是 “input_file_name;rm –rf /*” ,  出现问题 。 Java 标准类库本身进行了非常多的改进，所以类似这种编程错误，未必可以真的完成攻击，但其反映的一类场景是真实存在的。 

#####  XML 注入攻击 

 XML 注入攻击。Java 核心类库提供了全面的 XML 处理、转换等各种 API，而 XML 自身是可以包含动态内容的，例如 XPATH，如果使用不当，可能导致访问恶意内容。 

 针对 SQL 注入的解决办法：

-  在数据输入阶段，填补期望输入和可能输入之间的鸿沟。可以进行输入校验，限定什么类型的输入是合法的，例如，不允许输入标点符号等特殊字符，或者特定结构的输入。 
-  在 Java 应用进行数据库访问时，如果不用完全动态的 SQL，而是利用 PreparedStatement，可以有效防范 SQL 注入。不管是 SQL 注入，还是 OS 命令注入，程序利用字符串拼接生成运行逻辑都是个可能的风险点！ 
-  在数据库层面，如果对查询、修改等权限进行了合理限制，就可以在一定程度上避免被注入删除等高破坏性的代码。 

>  因为sql语句是**预编译**的，而且**语句中使用了占位符，规定了sql语句的结构。用户可以设置"?"的值，但是不能改变sql语句的结构**，因此想在sql语句后面加上如“or 1=1”实现sql注入是行不通的。 

> 实际开发中，一般采用PreparedStatement访问数据库，**它不仅能防止sql注入，还是预编译的(不用改变一次参数就要重新编译整个sql语句，效率高)，此外，它执行查询语句得到的结果集是离线的，连接关闭后，仍然可以访问结果集。** 